<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emoji Slot Machine</title>
  <style>
    body {
      background: #2d2d2d;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      background: #444;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    h1 {
      text-align: center;
    }
    .hidden {
      display: none;
    }
    .message {
      margin: 10px 0;
      padding: 10px;
      background: #333;
      border-radius: 4px;
      text-align: center;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input[type="number"], input[type="text"] {
      width: 100%;
      padding: 8px;
      border: none;
      border-radius: 4px;
    }
    button {
      width: 100%;
      padding: 10px;
      background: #007BFF;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    /* Machine styling */
    .machine {
      position: relative;
      background: url('slot-machine-bg.png');
      background-size: cover;
      background-position: center;
      border: 3px solid #fff;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      height: 200px;
    }
    .reels {
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 100%;
    }
    .reel {
      background: rgba(255, 255, 255, 0.2);
      padding: 10px;
      border-radius: 4px;
      font-size: 40px;
      width: 60px;
      height: 100px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }
    /* Spin animation using a blur effect */
    .spinning {
      animation: spin 0.1s linear infinite;
    }
    @keyframes spin {
      from {
        filter: blur(2px);
      }
      to {
        filter: blur(0px);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Emoji Slot Machine</h1>

    <!-- Deposit Section -->
    <div id="deposit-section">
      <div class="form-group">
        <label for="deposit">Enter your deposit amount:</label>
        <input type="number" id="deposit" min="1" placeholder="e.g. 100" />
      </div>
      <button id="deposit-btn">Deposit</button>
    </div>

    <!-- Game Section -->
    <div id="game-section" class="hidden">
      <div class="message" id="balance-message"></div>
      <div class="form-group">
        <label for="lines">Number of lines to bet on (1-3):</label>
        <input type="number" id="lines" min="1" max="3" placeholder="Enter 1, 2, or 3" />
      </div>
      <div class="form-group">
        <label for="bet">Bet per line:</label>
        <input type="number" id="bet" min="1" placeholder="Enter bet amount" />
      </div>
      <button id="spin-btn">Spin</button>
    </div>

    <!-- Result Section -->
    <div id="result-section" class="hidden">
      <div class="machine">
        <div class="reels" id="reels">
          <!-- Reel containers (3 reels for 3 columns) -->
          <div class="reel" id="reel-0">?</div>
          <div class="reel" id="reel-1">?</div>
          <div class="reel" id="reel-2">?</div>
        </div>
      </div>
      <div class="message" id="winnings-message"></div>
      <button id="play-again-btn">Play Again</button>
    </div>

    <!-- Game Over Section -->
    <div id="game-over-section" class="hidden">
      <div class="message" id="game-over-message"></div>
      <button id="restart-btn">Restart Game</button>
    </div>
  </div>

  <script>
    // Constants and game configuration
    const ROWS = 3;
    const COLS = 3;
    // Use emojis with counts & values (feel free to adjust these)
    const SYMBOLS_COUNT = { "🎈": 2, "🎊": 4, "🎁": 6 };
    const SYMBOL_VALUES = { "🎈": 5, "🎊": 4, "🎁": 3 };

    // Game state
    let balance = 0;

    // UI elements
    const depositSection = document.getElementById("deposit-section");
    const depositInput = document.getElementById("deposit");
    const depositBtn = document.getElementById("deposit-btn");

    const gameSection = document.getElementById("game-section");
    const balanceMessage = document.getElementById("balance-message");
    const linesInput = document.getElementById("lines");
    const betInput = document.getElementById("bet");
    const spinBtn = document.getElementById("spin-btn");

    const resultSection = document.getElementById("result-section");
    const winningsMessage = document.getElementById("winnings-message");
    const playAgainBtn = document.getElementById("play-again-btn");
    // Reels (reel divs)
    const reels = [
      document.getElementById("reel-0"),
      document.getElementById("reel-1"),
      document.getElementById("reel-2")
    ];

    const gameOverSection = document.getElementById("game-over-section");
    const gameOverMessage = document.getElementById("game-over-message");
    const restartBtn = document.getElementById("restart-btn");

    // Helper function to update balance display
    function updateBalanceMessage() {
      balanceMessage.textContent = `Current Balance: $${balance.toFixed(2)}`;
    }

    // Deposit event
    depositBtn.addEventListener("click", () => {
      const depositAmount = parseFloat(depositInput.value);
      if (isNaN(depositAmount) || depositAmount <= 0) {
        alert("Invalid deposit amount, try again.");
      } else {
        balance = depositAmount;
        updateBalanceMessage();
        depositSection.classList.add("hidden");
        gameSection.classList.remove("hidden");
      }
    });

    // Spin logic: returns an array of reels (each reel is an array of symbols)
    function spin() {
      const symbols = [];
      for (const [symbol, count] of Object.entries(SYMBOLS_COUNT)) {
        for (let i = 0; i < count; i++) {
          symbols.push(symbol);
        }
      }
      
      const reelsResult = [];
      for (let i = 0; i < COLS; i++) {
        const reelSymbols = [...symbols];
        const reel = [];
        for (let j = 0; j < ROWS; j++) {
          const randomIndex = Math.floor(Math.random() * reelSymbols.length);
          reel.push(reelSymbols[randomIndex]);
          reelSymbols.splice(randomIndex, 1);
        }
        reelsResult.push(reel);
      }
      return reelsResult;
    }

    // Transpose reels to get rows for winning check (each row contains one symbol from each reel)
    function transpose(reelsResult) {
      const rows = [];
      for (let i = 0; i < ROWS; i++) {
        const row = [];
        for (let j = 0; j < COLS; j++) {
          row.push(reelsResult[j][i]);
        }
        rows.push(row);
      }
      return rows;
    }

    // Calculate winnings based on the rows that the player bet on
    function getWinnings(rows, bet, lines) {
      let winnings = 0;
      for (let row = 0; row < lines; row++) {
        const rowSymbols = rows[row];
        if (rowSymbols.every(symbol => symbol === rowSymbols[0])) {
          winnings += bet * SYMBOL_VALUES[rowSymbols[0]];
        }
      }
      return winnings;
    }

    // Utility: generate a random emoji from the symbols pool (for spin simulation)
    function getRandomEmoji() {
      const emojiArray = Object.keys(SYMBOLS_COUNT);
      return emojiArray[Math.floor(Math.random() * emojiArray.length)];
    }

    // Simulate spinning animation by rapidly updating each reel with random emojis
    function animateSpin(duration = 1000, intervalTime = 100) {
      return new Promise(resolve => {
        const interval = setInterval(() => {
          reels.forEach(reel => {
            reel.textContent = getRandomEmoji();
            reel.classList.add("spinning");
          });
        }, intervalTime);
        setTimeout(() => {
          clearInterval(interval);
          reels.forEach(reel => reel.classList.remove("spinning"));
          resolve();
        }, duration);
      });
    }

    // Handle spin button click
    spinBtn.addEventListener("click", async () => {
      const numberOfLines = parseInt(linesInput.value);
      const bet = parseFloat(betInput.value);

      if (isNaN(numberOfLines) || numberOfLines < 1 || numberOfLines > 3) {
        alert("Invalid number of lines, please enter a value between 1 and 3.");
        return;
      }
      if (isNaN(bet) || bet <= 0 || bet > balance / numberOfLines) {
        alert("Invalid bet, please check your balance and enter a valid bet.");
        return;
      }

      // Deduct bet from balance
      const totalBet = bet * numberOfLines;
      balance -= totalBet;
      updateBalanceMessage();

      // Show result section and animate reels
      gameSection.classList.add("hidden");
      resultSection.classList.remove("hidden");

      // Start spin animation (simulate for 1 second)
      await animateSpin(1000, 100);

      // Spin and get final results
      const reelsResult = spin();
      const rows = transpose(reelsResult);
      // Update each reel with the final symbol from row 2 (center reel) or customize as needed
      reels.forEach((reel, idx) => {
        // For a simple effect, show the middle symbol of each reel
        reel.textContent = reelsResult[idx][1];
      });

      // Calculate winnings
      const winnings = getWinnings(rows, bet, numberOfLines);
      balance += winnings;
      winningsMessage.textContent = `You won $${winnings.toFixed(2)} this spin!`;
      updateBalanceMessage();

      // Check if player ran out of money
      if (balance <= 0) {
        gameOverMessage.textContent = "You ran out of money!";
        resultSection.classList.add("hidden");
        gameOverSection.classList.remove("hidden");
      }
    });

    // Play again button
    playAgainBtn.addEventListener("click", () => {
      resultSection.classList.add("hidden");
      gameSection.classList.remove("hidden");
    });

    // Restart game button from game over screen
    restartBtn.addEventListener("click", () => {
      balance = 0;
      depositInput.value = "";
      linesInput.value = "";
      betInput.value = "";
      reels.forEach(reel => reel.textContent = "?");
      winningsMessage.textContent = "";
      gameOverSection.classList.add("hidden");
      depositSection.classList.remove("hidden");
    });
  </script>
</body>
</html>
